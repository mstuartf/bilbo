<div class="home-header-container">

	<div class="home-header d-flex justify-center items-center" *ngIf="user && !user.monzoAuth">

		<div>
	    	<mat-spinner diameter="30" class="invisible"></mat-spinner>
	    </div>

	    <button
	      (click)="authorise()"
	      [disabled]="showSalarySpinner || showAuthSpinner || showNewSpinner || !dataSource"
	      mat-raised-button color="primary">
	      Click here to link your Monzo account! 
	    </button>

	    <div>
	    	<mat-spinner diameter="30" [ngClass]="{invisible: !showAuthSpinner}"></mat-spinner>
	    </div>

	</div>

</div>

<div class="home-card-container">

  <mat-card class="home-card">

    <mat-card-header class="home-card-header">

    	<mat-card-title>My Bills</mat-card-title>

	    <button
	      (click)="logout()"
	      [disabled]="showSalarySpinner || showAuthSpinner || showNewSpinner || !dataSource"
	      mat-button color="primary">
	      Logout
	    </button>

    </mat-card-header>

    <mat-card-content class="home-card-content">

      <table mat-table matSort [dataSource]="dataSource" class="home-table">

      	<ng-container matColumnDef="title">
		  <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
		  <td mat-cell *matCellDef="let bill"> {{bill.title}} </td>
		  <td mat-footer-cell *matFooterCellDef>Monthly Total</td>
		</ng-container>

      	<ng-container matColumnDef="periodFrequency">
		  <th mat-header-cell *matHeaderCellDef mat-sort-header>Every</th>
		  <td mat-cell *matCellDef="let bill"> {{bill.periodFrequency}} </td>
		  <td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

      	<ng-container matColumnDef="period">
		  <th mat-header-cell *matHeaderCellDef mat-sort-header>Period</th>
		  <td mat-cell *matCellDef="let bill"> {{bill.period}} </td>
		  <td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

      	<ng-container matColumnDef="firstPaymentDate">
		  <th mat-header-cell *matHeaderCellDef mat-sort-header>Starting from</th>
		  <td mat-cell *matCellDef="let bill"> {{bill.firstPaymentDate | date: 'dd/MM/yyyy'}} </td>
		  <td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

      	<ng-container matColumnDef="amount">
		  <th mat-header-cell *matHeaderCellDef mat-sort-header> Amount </th>
		  <td mat-cell *matCellDef="let bill"> {{ bill.amount | currency: '£' }} </td>
		  <td mat-footer-cell *matFooterCellDef> {{ billFeed.monthlyTotal | currency: '£' }} </td>
		</ng-container>

      	<ng-container matColumnDef="remove">
		  <th mat-header-cell *matHeaderCellDef></th>
		  <td mat-cell *matCellDef="let bill">
		  	<div class="mat-cell-inner">
		  		<button mat-icon-button (click)="removeBill(bill)" [disabled]="showSalarySpinner || showAuthSpinner || showNewSpinner">
			    	<mat-icon>delete_outline</mat-icon>
			  	</button>
		  	</div>
		  </td>
		  <td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
		<tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
		<tr mat-footer-row *matFooterRowDef="billFeed && billFeed.monthlyTotal ? columnsToDisplay : []"></tr>

      </table>

      <div *ngIf="!dataSource" class="mat-spinner-container">
         <mat-spinner diameter="50"></mat-spinner>
      </div>

    </mat-card-content>

    <mat-card-footer class="home-card-footer">

		<div class="d-flex items-center">

			<mat-form-field class="salary-date-form-field" *ngIf="user">

			  <mat-label>Salary date</mat-label>
			
			  <mat-select 
			    class="text-align-right"
			  	[disabled]="showSalarySpinner || showAuthSpinner || showNewSpinner || !dataSource" 
			  	[(ngModel)]="user.salaryDate"
			  	(selectionChange)="updateUser()">

			    <mat-option *ngFor="let date of [].constructor(31); let i = index" [value]="i + 1">
			      {{i + 1}}
			    </mat-option>

			  </mat-select>
			
			</mat-form-field>

			<div>
	    		<mat-spinner diameter="30" *ngIf="showSalarySpinner"></mat-spinner>
	    	</div>

		</div>

    	<div class="d-flex items-center">

    		<div class="small-mat-spinner-container">
	    		<mat-spinner diameter="30" *ngIf="showNewSpinner"></mat-spinner>
	    	</div>

		    <button
		      (click)="addBill()"
		      [disabled]="showSalarySpinner || showAuthSpinner || showNewSpinner || !dataSource"
		      mat-raised-button color="primary">
		      + New Bill
		    </button>

    	</div>

    </mat-card-footer>

  </mat-card>

</div>
